{% extends 'gestion_activos/base.html' %}
{% load static %}

{% block title %}Usuarios y Roles{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary"><i class="fas fa-users-cog me-2"></i>Usuarios y Roles</h2>
  <a href="{% url 'crear_usuario' %}" class="btn btn-success">
    <i class="fas fa-user-plus me-1"></i> Agregar Usuario
  </a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table id="tabla-usuarios" class="table table-bordered table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Usuario</th>
            <th>Nombre Completo</th>
            <th>Correo Electr√≥nico</th>
            <th>Grupo (Rol)</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for u in usuarios %}
          <tr>
            <td>{{ u.username }}</td>
            <td>{{ u.get_full_name|default:u.perfil.nombres|default:'' }} {{ u.perfil.apellidos|default:'' }}</td>
            <td>{{ u.email }}</td>
            <td>
              {% for group in u.groups.all %}
                <span class="badge bg-primary rounded-pill">{{ group.name }}</span>
              {% empty %}
                <span class="badge bg-secondary rounded-pill">Sin rol asignado</span>
              {% endfor %}
            </td>
            <td class="text-center">
              <a href="{% url 'editar_usuario' u.pk %}" class="btn btn-sm btn-warning" title="Editar">‚úèÔ∏è</a>
              <a href="{% url 'eliminar_usuario' u.pk %}" class="btn btn-sm btn-danger" title="Eliminar">üóëÔ∏è</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Inicializamos DataTables en nuestra tabla
    var table = $('#tabla-usuarios').DataTable({
        // Usamos el archivo de traducci√≥n al espa√±ol
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        },
        dom: '<"row mb-3"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
             '<"row"<"col-sm-12"t>>' +
             '<"row mt-3"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
    });

    // Personalizamos el campo de b√∫squeda que DataTables crea
    $('.dataTables_filter input')
      .attr('placeholder', 'Buscar en la tabla...')
      .addClass('form-control form-control-sm');
});
</script>
{% endblock %}
