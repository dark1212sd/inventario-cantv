{% extends 'gestion_activos/base.html' %}
{% load static %}

{% block title %}Usuarios y Roles{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="text-primary fw-bold">Usuarios y Roles</h2>

  <div class="d-flex align-items-center gap-2">
    <!-- Buscador con icono -->
    <div id="buscador-wrapper" class="position-relative">
      <i id="icono-buscar" class="fas fa-search fs-4 text-dark" style="cursor:pointer;"></i>
      <input type="text" id="input-busqueda" class="form-control form-control-sm animate__animated"
             style="width: 0; opacity: 0; position: absolute; top: -5px; left: 30px; transition: all 0.3s;"
             placeholder="Buscar usuario">
    </div>
    <!-- Bot√≥n agregar -->
    <a href="{% url 'crear_usuario' %}" class="btn btn-success btn-sm animate__animated animate__fadeInRight">
      <i class="fas fa-user-plus"></i> Agregar Usuario
    </a>
  </div>
</div>

<table id="tabla-usuarios" class="table table-striped table-bordered">
  <thead class="table-primary">
    <tr>
      <th>Usuario</th>
      <th>Grupos</th>
      <th>Permisos</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for u in usuarios %}
    <tr>
      <td>{{ u.username }}</td>
      <td>{{ u.groups.all|join:", " }}</td>
      <td>{{ u.get_all_permissions|join:", " }}</td>
      <td>
        <a href="{% url 'editar_usuario' u.pk %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
        <a href="{% url 'eliminar_usuario' u.pk %}" class="btn btn-sm btn-danger">üóëÔ∏è</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_js %}
<script>
  $(function () {
    const tabla = $('#tabla-usuarios').DataTable({
      pageLength: 10,
      language: { url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' }
    });

    const input = document.getElementById('input-busqueda');
    $('#icono-buscar').on('click', function () {
      if (input.style.width === "0px" || input.style.width === "") {
        input.style.width = "200px";
        input.style.opacity = "1";
        input.focus();
      } else {
        input.style.width = "0";
        input.style.opacity = "0";
      }
    });

    input.addEventListener('keyup', function () {
      tabla.search(this.value).draw();
    });
  });
</script>
{% endblock %}