

{% extends 'gestion_activos/base.html' %}
{% load static %}

{% block title %}Usuarios y Roles{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary fw-bold"><i class="fas fa-users-cog me-2"></i>Usuarios y Roles</h2>
  <a href="{% url 'crear_usuario' %}" class="btn btn-success shadow-sm">
    <i class="fas fa-user-plus me-1"></i> Agregar Usuario
  </a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table id="tabla-usuarios" class="table table-hover" style="width:100%">
        <thead class="table-light">
          <tr>
            <th>Usuario</th>
            <th>Nombre Completo</th>
            <th>Correo Electrónico</th>
            <th>Grupo (Rol)</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for u in usuarios %}
          <tr>
            <td><strong>{{ u.username }}</strong></td>
            <td>
              {# Mostramos el nombre completo o un texto por defecto si está vacío #}
              {{ u.get_full_name|default:'<span class="text-muted fst-italic">No especificado</span>'|safe }}
            </td>
            <td>{{ u.email }}</td>
            <td>
              {% for group in u.groups.all %}
                <span class="badge bg-primary rounded-pill fw-normal">{{ group.name }}</span>
              {% empty %}
                <span class="badge bg-secondary rounded-pill fw-normal">Sin rol asignado</span>
              {% endfor %}
            </td>
            <td class="text-center">
              {# Usamos iconos de FontAwesome para las acciones #}
              <a href="{% url 'editar_usuario' u.pk %}" class="btn btn-sm btn-outline-warning" title="Editar Usuario">
                <i class="fas fa-pencil-alt"></i>
              </a>
              <a href="{% url 'eliminar_usuario' u.pk %}" class="btn btn-sm btn-outline-danger" title="Eliminar Usuario">
                <i class="fas fa-trash-alt"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#tabla-usuarios').DataTable({
        language: {
            url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        },
        // Controla la disposición de los elementos de DataTables (buscador, paginación, etc.)
        dom: '<"row mb-3"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
             '<"row"<"col-sm-12"t>>' +
             '<"row mt-3"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
        // Desactiva el ordenamiento en la columna de 'Acciones'
        "columnDefs": [
            { "orderable": false, "targets": 4 }
        ]
    });

    // Personaliza el campo de búsqueda generado por DataTables
    $('.dataTables_filter input')
      .attr('placeholder', 'Buscar...')
      .addClass('form-control form-control-sm');
});
</script>
{% endblock %}