{% extends 'gestion_activos/base.html' %}
{% load static %}

{% block title %}Usuarios y Roles{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary fw-bold">
    <i class="fas fa-users-cog me-2"></i>Usuarios y Roles
  </h2>
  <a href="{% url 'crear_usuario' %}" class="btn btn-success shadow-sm">
    <i class="fas fa-user-plus me-1"></i> Nuevo Usuario
  </a>
</div>

<div class="position-relative mb-3">
  <i class="fas fa-search search-icon"></i>
  <input type="text" id="busqueda-usuario" class="form-control search-input" placeholder="Buscar usuario...">
</div>

<div class="table-responsive shadow-sm rounded">
  <table id="tabla-usuarios" class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Usuario</th>
        <th>Grupos</th>
        <th>Permisos</th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for u in usuarios %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.groups.all|join:", " }}</td>
        <td>{{ u.get_all_permissions|join:", " }}</td>
        <td class="text-center">
          <a href="{% url 'editar_usuario' u.pk %}" class="btn btn-warning btn-sm me-1"><i class="fas fa-edit"></i></a>
          <a href="{% url 'eliminar_usuario' u.pk %}" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block extra_js %}
<style>
  .search-icon {
    position: absolute;
    top: 50%;
    left: 10px;
    transform: translateY(-50%);
    color: #999;
  }
  .search-input {
    padding-left: 35px;
    border-radius: 30px;
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
  }
  .search-input:focus {
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.15);
  }
</style>
<script>
  $(document).ready(function () {
    const tabla = $('#tabla-usuarios').DataTable({
      pageLength: 10,
      language: { url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' },
      dom: 'rt<"d-flex justify-content-between align-items-center mt-2"lip>',
    });

    // Filtro por input personalizado
    $('#busqueda-usuario').on('keyup', function () {
      tabla.search(this.value).draw();
    });
  });
</script>
{% endblock %}